<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ETH Buy Table</title>
  <style>
    /* Base Layout */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 30px 20px;
      background: #eef2f7;
      color: #222;
    }

    .container {
      max-width: 1050px;
      margin: 0 auto;
      background: #fff;
      padding: 28px 26px;
      border-radius: 14px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    }

    h1 {
      text-align: center;
      margin-bottom: 26px;
      font-size: 24px;
      font-weight: 700;
    }

    /* API Info Display */
    #fetchedInfo {
      text-align: center;
      margin-bottom: 24px;
      font-size: 15px;
      font-weight: 600;
    }

    #currentPriceDisplay,
    #lastBuyDisplay {
      padding: 3px 6px;
    }

    /* Inputs Panel */
    .inputs {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 22px;
      margin-bottom: 32px;
      padding: 12px;
    }

    .inputs div {
      display: flex;
      flex-direction: column;
    }

    .inputs label {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .inputs input {
      padding: 9px 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .inputs input:focus {
      border-color: #007bff;
      outline: 3px solid rgba(0,123,255,0.15);
    }

    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      border: 1px solid #e0e4ea;
      padding: 12px 8px;
    }

    th {
      background: #007bff;
      color: #fff;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.3px;
    }

    tr:nth-child(even) {
      background: #f8fafc;
    }

    tr:hover {
      background: rgba(0,123,255,0.04);
    }

    /* Profit/Loss Coloring */
    .profit {
      color: #0a9d58; /* Green */
      font-weight: 700;
    }

    .loss {
      color: #d93025; /* Red */
      font-weight: 700;
    }

    /* Close Button */
    button {
      padding: 6px 12px;
      font-size: 13px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s ease;
    }

    button:hover {
      opacity: 0.85;
      transform: scale(1.03);
    }

    .btn-close {
      background: #007bff;
      color: #fff;
    }

  </style>
</head>
<body>

<div class="container">
  <h1>ETH Buy Table</h1>

  <!-- API Fetch Confirmation Panel -->
  <div id="fetchedInfo">
    Current ETH Price: <span id="currentPriceDisplay">-</span> USD | 
    Nearest Buy Order: <span id="lastBuyDisplay">-</span> USD
  </div>

  <!-- Inputs -->
  <div class="inputs">
    <div>
      <label>Start Price</label>
      <input id="startPrice" type="number">
    </div>
    <div>
      <label>End Price</label>
      <input id="endPrice" type="number">
    </div>
    <div>
      <label>Price Step (USD)</label>
      <input id="step" type="number">
    </div>
    <div>
      <label>Lot Size (ETH)</label>
      <input id="lotSize" type="number" step="0.0001">
    </div>
    <div>
      <label>Nearest Buy Order</label>
      <input id="lastBuy" type="number">
    </div>
  </div>

  <!-- Table -->
  <table id="buyTable">
    <thead>
      <tr>
        <th>Buy Price</th>
        <th>ETH Bought</th>
        <th>Cost</th>
        <th>Current Value</th>
        <th>Gross P/L</th>
        <th>Fee 0.2%</th>
        <th>Net P/L</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// Enhance Table Row Logic with Profit/Loss Colors + Close Button Style
function buildTable(currentPrice) {
  const start = parseFloat(document.getElementById('startPrice').value);
  const end   = parseFloat(document.getElementById('endPrice').value);
  const step  = parseFloat(document.getElementById('step').value);
  const lot   = parseFloat(document.getElementById('lotSize').value);
  const lastBuy = parseFloat(document.getElementById('lastBuy').value);

  const tbody = document.querySelector('#buyTable tbody');
  tbody.innerHTML = '';

  const feeRate = 0.002;
  const buys = [];
  for (let p = start; p >= end; p -= step) {
    buys.push(p);
  }
  buys.reverse();

  buys.forEach(buyPrice => {
    const cost = lot * buyPrice;
    const currentValue = lot * currentPrice;
    const gross = currentValue - cost;
    const fee   = cost * feeRate;
    const net   = gross - fee;
    const profitable = buyPrice > lastBuy;

    const tr = document.createElement('tr');

    // Columns 1-7
    tr.innerHTML = `
      <td>${buyPrice.toFixed(2)}</td>
      <td>${lot.toFixed(4)}</td>
      <td>${cost.toFixed(2)}</td>
      <td>${currentValue.toFixed(2)}</td>
      <td class="${profitable && gross >= 0 ? 'profit' : (profitable && gross < 0 ? 'loss' : '')}">
        ${profitable ? gross.toFixed(2) : ''}
      </td>
      <td>${profitable ? fee.toFixed(2) : ''}</td>
      <td class="${profitable && net >= 0 ? 'profit' : (profitable && net < 0 ? 'loss' : '')}">
        ${profitable ? net.toFixed(2) : ''}
      </td>
    `;

    // Close Button in Action Column
    const tdAction = document.createElement('td');
    if (profitable && net > 0) {
      const btn = document.createElement('button');
      btn.textContent = 'Close';
      btn.className = 'btn-close';
      btn.addEventListener('click', () => closeAndRebuy(buyPrice, lot));
      tdAction.appendChild(btn);
    }
    tr.appendChild(tdAction);

    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
